{"componentChunkName":"component---src-templates-blog-post-js","path":"/laravel-the-strategy-pattern/","result":{"data":{"site":{"siteMetadata":{"title":"Personal Blog"}},"markdownRemark":{"id":"fe898d33-977f-5b82-856a-cf95b77ac8e3","excerpt":"Hello 👋  Wikipedia: In computer programming, the strategy pattern (also known as the policy pattern) is a behavioral software design pattern that enables an…","html":"<h2 id=\"hello-\" style=\"position:relative;\"><a href=\"#hello-\" aria-label=\"hello  permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>Hello 👋</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df0243e269bcccfc0c319699902a2e6e/0f882/cover.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABI0lEQVR42k2PyU7CABRF+w1axhZaSucBwQ60tYNYEFTUKCa6cOf/f8MxrSxcvNybuzg5T5gMZwxEhUFPJb8OWcwtxIsp7b6yPG7XazaBTeH7JKuIxHHwNYvxYIYy0pgMta73RQVFMhBi20bqq/R7KnWSEFoO4uUUU3PY3uR8nV7ZRwHPdc6uKmmylKUTIA01tKmJ/A/YpnA1N5BboKh0NqemoorX3GU5n487vt+P/Hw88bbfsisK7ouCap1RJil1mqNIOsOe+velqCJEpsXCsIldj8NmQ5NEHJuaMorxdQfP8DgUKZqsd1YL00U9d3mkdTk6C7UnhLZL5HhEXsDp5chDmVGnKbHrEwcrHMPvzGey0dnEy7ADjc+Q+cRAV8zOsgX/Ak7ZlkKeX+MCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"cover\"\n        src=\"/static/df0243e269bcccfc0c319699902a2e6e/f058b/cover.png\"\n        srcset=\"/static/df0243e269bcccfc0c319699902a2e6e/c26ae/cover.png 158w,\n/static/df0243e269bcccfc0c319699902a2e6e/6bdcf/cover.png 315w,\n/static/df0243e269bcccfc0c319699902a2e6e/f058b/cover.png 630w,\n/static/df0243e269bcccfc0c319699902a2e6e/40601/cover.png 945w,\n/static/df0243e269bcccfc0c319699902a2e6e/78612/cover.png 1260w,\n/static/df0243e269bcccfc0c319699902a2e6e/0f882/cover.png 1584w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Wikipedia: In computer programming, the strategy pattern (also known as the policy pattern) is a behavioral software design pattern that enables an algorithm's behavior to be selected at runtime.</p>\n</blockquote>\n<p>For the first time, a Wikipedia definition in an IT context makes sense to me. Nonetheless, we'll be discussing the strategy pattern in this article and how Laravel uses it under the hood. It's commonly referred to as the Manager pattern in the Laravel community. I've also encountered it labeled as the \"Builder\" pattern in a <a href=\"https://www.amazon.com/Laravel-Design-Patterns-Best-Practices/dp/1783287985\">book</a>, something I don't agree with, and I'll explain why later on. In simple terms, the strategy pattern allows you to switch the implementation (or algorithm) based on a condition. Now, before we dive deeper, it's important to understand that these patterns are not sacred texts; they can be implemented in various ways 🤷 (<strong>YES REDDIT, YES, I'M LOOKING AT YOU</strong>). Patterns will always address the same problem, but can introduce some tweaks, and that's exactly what Laravel has done.</p>\n<h2 id=\"what-problem-are-we-solving-and-how\" style=\"position:relative;\"><a href=\"#what-problem-are-we-solving-and-how\" aria-label=\"what problem are we solving and how permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>What problem are we solving and how?</h2>\n<p>In Laravel, you have probably called the <code class=\"language-text\">driver()</code> method (at least once), when using the <code class=\"language-text\">Cache</code> facade, with the <code class=\"language-text\">Mail</code>, or when logging. Let's stick with caching.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token class-name static-context\">Cache</span><span class=\"token operator\">::</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token argument-name\">key</span><span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token argument-name\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will cache the value <code class=\"language-text\">'bar'</code>, using the database driver. Now the problem is we don't want to force users to use a single driver; they can choose different ones, like a file driver, a Redis driver, or whatever driver. So we need a way to swap between those implementations based on a condition that the users set, or can affect. If nothing is set, we can always fall back to the default driver.</p>\n<p>Laravel solves this by implementing the strategy pattern (or the manager pattern), which allows you to set a driver to be used. For example, if we want to use the file driver instead of the database, we can simply call the <code class=\"language-text\">driver()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token class-name static-context\">Cache</span><span class=\"token operator\">::</span><span class=\"token function\">driver</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The file driver will be used instead of the database because we <strong>altered a condition</strong> that picks the behavior (implementation) at runtime. Let's see how.</p>\n<h2 id=\"demystifying-the-magic\" style=\"position:relative;\"><a href=\"#demystifying-the-magic\" aria-label=\"demystifying the magic permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>Demystifying the magic</h2>\n<p>When you call the driver method on the facade, it's proxied to a manager, depending on which facade you're using. In the caching scenario, it's directed to the <a href=\"https://github.com/laravel/framework/blob/master/src/Illuminate/Cache/CacheManager.php\" target=\"_blank\"><code class=\"language-text\">CacheManager</code></a>. Let's inspect its code.</p>\n<blockquote>\n<p>Curious about how we got to the Manager from the facade? I highly recommend reading <a href=\"https://blog.oussama-mater.tech/laravel-core-facades/\" target=\"_blank\">\"Facades Under The Hood\"</a>.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Cache</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Cache<span class=\"token punctuation\">\\</span>Factory</span> <span class=\"token keyword\">as</span> FactoryContract<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @mixin \\Illuminate\\Cache\\Repository\n * @mixin \\Illuminate\\Contracts\\Cache\\LockProvider\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">CacheManager</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FactoryContract</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// omitted for brevity</span>\n\n    <span class=\"token comment\">/**\n     * Get a cache driver instance.\n     *\n     * @param  string|null  $driver\n     * @return \\Illuminate\\Contracts\\Cache\\Repository\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">driver</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$driver</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">store</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$driver</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// omitted for brevity</span>\n<span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<p>Here, you'll find the <code class=\"language-text\">driver()</code> method, which optionally accepts a driver. This method returns whatever results from <code class=\"language-text\">store()</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Cache</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Cache<span class=\"token punctuation\">\\</span>Factory</span> <span class=\"token keyword\">as</span> FactoryContract<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @mixin \\Illuminate\\Cache\\Repository\n * @mixin \\Illuminate\\Contracts\\Cache\\LockProvider\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">CacheManager</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FactoryContract</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// omitted for brevity</span>\n\n    <span class=\"token comment\">/**\n     * Get a cache store instance by name, wrapped in a repository.\n     *\n     * @param  string|null  $name\n     * @return \\Illuminate\\Contracts\\Cache\\Repository\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">store</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// This is the condition we modified by passing a driver.</span>\n        <span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$name</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">getDefaultDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">stores</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">??=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// omitted for brevity</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>If no <code class=\"language-text\">$name</code> (driver) is set by the user, it defaults to the default driver specified in the configuration under <code class=\"language-text\">cache.default</code> (have a quick look <a href=\"https://github.com/laravel/framework/blob/master/src/Illuminate/Cache/CacheManager.php#L356\" target=\"_blank\">here</a>). Subsequently, it attempts to resolve that driver. Now, let's inspect the <code class=\"language-text\">resolve()</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Cache</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Cache<span class=\"token punctuation\">\\</span>Factory</span> <span class=\"token keyword\">as</span> FactoryContract<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @mixin \\Illuminate\\Cache\\Repository\n * @mixin \\Illuminate\\Contracts\\Cache\\LockProvider\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">CacheManager</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FactoryContract</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// omitted for brevity</span>\n\n    <span class=\"token comment\">/**\n     * Resolve the given store.\n     *\n     * @param  string  $name\n     * @return \\Illuminate\\Contracts\\Cache\\Repository\n     *\n     * @throws \\InvalidArgumentException\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$config</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InvalidArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Cache store [<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">}</span></span>] is not defined.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$config</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">Arr</span><span class=\"token operator\">::</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'store'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">customCreators</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'driver'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">callCustomCreator</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$driverMethod</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'create'</span> <span class=\"token operator\">.</span> <span class=\"token function\">ucfirst</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'driver'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'Driver'</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">method_exists</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$driverMethod</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token punctuation\">{</span><span class=\"token variable\">$driverMethod</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InvalidArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Driver [<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'driver'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span>] is not supported.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// omitted for brevity</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>You notice that we first fetch the configuration for that driver, so we can build it. Then, we check if the developer <a href=\"https://laravel.com/docs/11.x/cache#adding-custom-cache-drivers\" target=\"_blank\">extended the cache drivers</a>. Finally, we create a method name following the convention <code class=\"language-text\">create[Name]driver</code>. In our case, it will be <code class=\"language-text\">createFileDriver</code>. Afterward, we call this method (which indeed <a href=\"https://github.com/laravel/framework/blob/master/src/Illuminate/Cache/CacheManager.php#L147\" target=\"_blank\">exists</a>) and return the cache implementation for the file driver. This way, the <code class=\"language-text\">put()</code> and <code class=\"language-text\">get()</code> methods are called on that implementation.</p>\n<p>This implies that if we called <code class=\"language-text\">Cache::driver('redis')</code>, we would be invoking a method called <code class=\"language-text\">createRedisDriver</code>, which in turn would return the implementation for the redis driver, and so forth.</p>\n<blockquote>\n<p>The <em>strategy</em> (cache implementation) changes depending on the condition (the given name).</p>\n</blockquote>\n<h2 id=\"sounds-cool-can-we-leverage-it\" style=\"position:relative;\"><a href=\"#sounds-cool-can-we-leverage-it\" aria-label=\"sounds cool can we leverage it permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>Sounds cool, can we leverage it?</h2>\n<p>Yes! That's the beauty of source diving. You can now make use of this in your application if you want to swap between different implementations. And the fun part is, there is already a base manager ready to be used!</p>\n<p>Let's imagine we are building a notifications system. There are multiple channels: SMS, Emails, Slack, and Discord. Our code will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Managers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Notification<span class=\"token punctuation\">\\</span>DiscordNotification</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Notification<span class=\"token punctuation\">\\</span>EmailNotification</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Notification<span class=\"token punctuation\">\\</span>SlackNotification</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Notification<span class=\"token punctuation\">\\</span>SmsNotification</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Manager</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">NotificationsManager</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Manager</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">createSmsDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// create[Name]Driver</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SmsNotification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">createEmailDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// create[Name]Driver</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EmailNotification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">createSlackDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// create[Name]Driver</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SlackNotification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">createDiscordDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// create[Name]Driver</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DiscordNotification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getDefaultDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'slack'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// will turn into createSlackDriver</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>You can see we didn't define the <code class=\"language-text\">driver()</code> method ourselves, instead, we extended the <a href=\"https://github.com/laravel/framework/blob/master/src/Illuminate/Support/Manager.php\" target=\"_blank\">base manager</a> which already has it. Now all you are left to do is to wrap this <code class=\"language-text\">NotificationsManager</code> in a <code class=\"language-text\">Notification</code> facade.</p>\n<blockquote>\n<p>I won't cover how to do it in this article. That's a good exercise for you. Stuck? here is <a href=\"https://blog.oussama-mater.tech/laravel-core-facades/#lets-make-our-facade\" target=\"_blank\">how</a>.</p>\n</blockquote>\n<p>Suppose we created the facade; you can now do</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Notification</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name static-context\">Notification</span><span class=\"token operator\">::</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// will use the default driver, slack</span>\n<span class=\"token class-name static-context\">Notification</span><span class=\"token operator\">::</span><span class=\"token function\">driver</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'discord'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// will use the discord driver</span>\n<span class=\"token class-name static-context\">Notification</span><span class=\"token operator\">::</span><span class=\"token function\">driver</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'email'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// will use the email driver</span>\n<span class=\"token class-name static-context\">Notification</span><span class=\"token operator\">::</span><span class=\"token function\">driver</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'sms'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// will use the sms driver</span></span></code></pre></div>\n<p>That's it, you created your own manager!</p>\n<h2 id=\"change-my-mind\" style=\"position:relative;\"><a href=\"#change-my-mind\" aria-label=\"change my mind permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>Change My Mind</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b71ad1c13a1591e2b1d0db73be405ae/b739f/meme.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACA//EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAEWuzZQyIf/xAAYEAADAQEAAAAAAAAAAAAAAAABAhEAEv/aAAgBAQABBQKzBm3b6RQUhjH/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwEn/8QAGBABAQEBAQAAAAAAAAAAAAAAAQARENH/2gAIAQEABj8C3JTp5Lf/xAAaEAEBAQADAQAAAAAAAAAAAAABEQAhMUFh/9oACAEBAAE/IaoT73gxILamn7iv6YTsOOMkhv/aAAwDAQACAAMAAAAQK8//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QRLL/xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAECAQE/EIejh//EAB4QAQEAAgEFAQAAAAAAAAAAAAERACFRMUFhcaHR/9oACAEBAAE/EAM93DU85PFdTVJ9yIH1k/cQLt3XjjASedDrXQYuQlRdMC5//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"meme\"\n        title=\"meme\"\n        src=\"/static/6b71ad1c13a1591e2b1d0db73be405ae/b739f/meme.jpg\"\n        srcset=\"/static/6b71ad1c13a1591e2b1d0db73be405ae/ff44c/meme.jpg 158w,\n/static/6b71ad1c13a1591e2b1d0db73be405ae/a6688/meme.jpg 315w,\n/static/6b71ad1c13a1591e2b1d0db73be405ae/b739f/meme.jpg 577w\"\n        sizes=\"(max-width: 577px) 100vw, 577px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In the introduction, I mentioned my disagreement with associating the manager pattern with the builder pattern. Perhaps the author saw similarities with the builder pattern more than with the strategy pattern, but for me, it doesn't align. The builder pattern allows you to construct complex objects with dynamic attributes.</p>\n<blockquote>\n<p>Wikipedia: The builder pattern is an object creation software design pattern with the intention of finding a solution to the telescoping constructor anti-pattern.</p>\n</blockquote>\n<p>A basic implementation of the builder pattern might look like this</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BurgerBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">addPickles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">addLettuce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">addTomato</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Each burger can be different; some might have cheese, some might not have lettuce (<strong>I HATE LETTUCE, IT FREAKING SUCKS</strong>). This pattern fits perfectly, otherwise, we would end up with a bloated constructor like this</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cheese</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pickles</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$tomato</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$lettuce</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Similarly, when sending an email in Laravel, we do</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token class-name static-context\">Mail</span><span class=\"token operator\">::</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">cc</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$moreUsers</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">bcc</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$evenMoreUsers</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">condition</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">locale</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">locale</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">OrderShipped</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$order</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Each mail object will vary from case to case; one object might only have the <code class=\"language-text\">to()</code> method. Again, if it weren't for this implementation, we would end up with a constructor like this</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$users</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$cc</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$bcc</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$when</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$locale</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>They look pretty similar, right? They're almost identical.</p>\n<blockquote>\n<p>Well, one for burgers, the other for mails, but hey you got me 🍔</p>\n</blockquote>\n<p>The Laravel example is known as the \"pending pattern\", which is essentially a builder pattern. That's why I prefer not to associate the manager pattern with the latter.</p>\n<blockquote>\n<p>Let me know if you want me to write about the pending object!</p>\n</blockquote>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>Conclusion</h2>\n<p>Patterns solve problems. You don't have to use them everywhere, nor do you have to overdo it. However, it's valuable to understand which pattern is suitable for which situation and what is being used in your framework. This understanding can simplify your workflow. As you've seen, we implemented our manager in just a few lines of code because we understand how Laravel works. Don't expect the implementation or the naming to always be the same; <em>they are not sacred texts</em>. They can be tweaked to suit your needs. Problems may be similar, but they are not always identical.</p>\n<blockquote>\n<p>If you have any thoughts we can include in the article, feel free to ping me!</p>\n</blockquote>","frontmatter":{"title":"Laravel Under The Hood - The Strategy Pattern","date":"May 12, 2024","description":"Have you ever wondered how Laravel switches between different drivers' implementations? Well, hang tight, we will learn how!"}},"previous":{"fields":{"slug":"/facades-write-testable-code/"},"frontmatter":{"title":"Laravel Facades - Write Testable Code"}},"next":null},"pageContext":{"id":"fe898d33-977f-5b82-856a-cf95b77ac8e3","previousPostId":"956642b6-a0f2-5634-9742-a6d32b383180","nextPostId":null}},"staticQueryHashes":["2841359383","494442451"],"slicesMap":{}}
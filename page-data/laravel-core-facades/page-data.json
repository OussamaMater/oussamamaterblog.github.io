{"componentChunkName":"component---src-templates-blog-post-js","path":"/laravel-core-facades/","result":{"data":{"site":{"siteMetadata":{"title":"Personal Blog"}},"markdownRemark":{"id":"dd83214f-98ff-5a9b-a1f6-07a02ac42647","excerpt":"Hello  ðŸ‘‹  You've just installed a fresh Laravel application, booted it up, and got the welcome page. Like everyone else, you try to see how it's rendered, soâ€¦","html":"<h2>Hello <code class=\"language-text\">Facades</code> ðŸ‘‹</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/365ed2d57e215261165f4f3f0a3f1c24/0f882/cover-facade.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA9UlEQVR42l2QwU7CQBRF+xG0nZZOpW+C0VaLNYwS6BiMEQIYTYxx4dKV//8DxzClBlncvPs25913g++zgq9cMKkwz4R6KITKECWGSBnixBAqIVLifa9+30+dGLKDDz5y4TkTdlr4zMXDlRKaa8vULSgbx91ijZ2vuLp1VI1jfGmJ4uIPaFLDKO0OB2stvGphpYWfUUGbCYO4oG5aZo87rNsyW754TdsNtt1SThaEceG/2EP6D3zCNy2854LLupkmhkEsnFf3TOwTtV1STx0T+0B103qNS+uBSWIoh8YnDA8VBBdpB9poQVL5182pTjtUB+D4CPgLhLeQUF5198wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover facade\"\n        title=\"cover facade\"\n        src=\"/static/365ed2d57e215261165f4f3f0a3f1c24/f058b/cover-facade.png\"\n        srcset=\"/static/365ed2d57e215261165f4f3f0a3f1c24/c26ae/cover-facade.png 158w,\n/static/365ed2d57e215261165f4f3f0a3f1c24/6bdcf/cover-facade.png 315w,\n/static/365ed2d57e215261165f4f3f0a3f1c24/f058b/cover-facade.png 630w,\n/static/365ed2d57e215261165f4f3f0a3f1c24/40601/cover-facade.png 945w,\n/static/365ed2d57e215261165f4f3f0a3f1c24/78612/cover-facade.png 1260w,\n/static/365ed2d57e215261165f4f3f0a3f1c24/0f882/cover-facade.png 1584w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You've just installed a fresh Laravel application, booted it up, and got the welcome page. Like everyone else, you try to see how it's rendered, so you hop into the <code class=\"language-text\">web.php</code> file and encounter this code</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Route</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name static-context\">Route</span><span class=\"token operator\">::</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">view</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'welcome'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>It's obvious how we got the welcome view, but you're curious about how Laravel's router works, so you decide to dive into the code. The initial assumption is: There's a <code class=\"language-text\">Route</code> class on which we're calling a static method <code class=\"language-text\">get()</code>. However, upon clicking it, there is no <code class=\"language-text\">get()</code> method there. So, what kind of dark magic is happening? Let's demystify this!</p>\n<h2>Regular Facades</h2>\n<blockquote>\n<p>Please note that I stripped most of the PHPDocs and inlined the types just for simplicity, \"...\" refers to more code.</p>\n</blockquote>\n<blockquote>\n<p>I strongly suggest opening your IDE and following along with the code to avoid any confusion.</p>\n</blockquote>\n<p>Following our example, let's explore the <code class=\"language-text\">Route</code> class</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Route</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Facade</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFacadeAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'router'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>There's not much here, just the <code class=\"language-text\">getFacadeAccessor()</code> method that returns the string <code class=\"language-text\">router</code>. Keeping this in mind, let's move to the parent class</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">RuntimeException</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Facade</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__callStatic</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">string</span> <span class=\"token variable\">$method</span><span class=\"token punctuation\">,</span> <span class=\"token keyword type-hint\">array</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">mixed</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$instance</span> <span class=\"token operator\">=</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token function\">getFacadeRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token variable\">$instance</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'A facade root has not been set.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$instance</span><span class=\"token operator\">-></span><span class=\"token variable\">$method</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token variable\">$args</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<p>Within the parent class, there are lots of methods, there isn't a <code class=\"language-text\">get()</code> method though. But, there is an interesting one, the <a href=\"https://www.php.net/manual/en/language.oop5.magic.php\"><code class=\"language-text\">__callStatic()</code></a> method. It's a <em>magic</em> method, invoked whenever an undefined static method, like <code class=\"language-text\">get()</code> in our case, is called. Therefore, our call <code class=\"language-text\">__callStatic('get', ['/', Closure()])</code> represents what we passed when invoking <code class=\"language-text\">Route::get()</code>, the route <code class=\"language-text\">/</code> and a <code class=\"language-text\">Closure()</code> that returns the welcome view.</p>\n<p>When <code class=\"language-text\">__callStatic()</code> gets triggered, it first attempts to set a variable <code class=\"language-text\">$instance</code> by calling <code class=\"language-text\">getFacadeRoot()</code>, the <code class=\"language-text\">$instance</code> holds the actual class to which the call should be forwarded, let's take a closer look, it will make sense in a bit</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Facade.php</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFacadeRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token function\">resolveFacadeInstance</span><span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token function\">getFacadeAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Hey, look it is the <code class=\"language-text\">getFacadeAccessor()</code> from the child class <code class=\"language-text\">Route</code>, which we know returned the string <code class=\"language-text\">router</code>. This <code class=\"language-text\">router</code> string is then passed to <code class=\"language-text\">resolveFacadeInstance()</code>, which attempts to resolve it to a class, a sort of mapping that says \"What class does this string represent?\", let's see</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Facade.php</span>\n\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">resolveFacadeInstance</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$resolvedInstance</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$resolvedInstance</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$cached</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$resolvedInstance</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It first checks if a static array, <code class=\"language-text\">$resolvedInstance</code>, has a value set with the given <code class=\"language-text\">$name</code> (which, again, is <code class=\"language-text\">router</code>). If it finds a match, it just returns that value. This is Laravel caching to optimize performance a little bit. This caching occurs within a single request, if this method is called multiple times with the same argument within the same request, it uses the cached value. Let's assume it's the initial call and proceed.</p>\n<p>It then checks if <code class=\"language-text\">$app</code> is set, and <code class=\"language-text\">$app</code> is an instance of the application container</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Facade.php</span>\n\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token class-name class-name-fully-qualified type-declaration\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Application</span> <span class=\"token variable\">$app</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you're curious about what an application container is, think of it as a box where your classes are stored. When you need those classes, you simply reach into that box. Sometimes this container performs a bit of magic, even if the box is empty, and you reach to grab a class, it will get it for you. That's a topic for another article.</p>\n<p>Now, you might wonder, \"When is <code class=\"language-text\">$app</code> set?\", because it needs to be, otherwise we won't have our <code class=\"language-text\">$instance</code>. This application container gets set during our application's bootstrapping process. Let's take a quick look at the <code class=\"language-text\">\\Illuminate\\Foundation\\Http\\Kernel</code> class</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Http</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Response</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Facade</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Kernel</span> <span class=\"token keyword\">as</span> KernelContract<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Kernel</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">KernelContract</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$app</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$bootstrappers</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token class-name class-name-fully-qualified static-context\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap<span class=\"token punctuation\">\\</span>LoadEnvironmentVariables</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name class-name-fully-qualified static-context\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap<span class=\"token punctuation\">\\</span>LoadConfiguration</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name class-name-fully-qualified static-context\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap<span class=\"token punctuation\">\\</span>HandleExceptions</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name class-name-fully-qualified static-context\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap<span class=\"token punctuation\">\\</span>RegisterFacades</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// &lt;- this guy</span>\n        <span class=\"token class-name class-name-fully-qualified static-context\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap<span class=\"token punctuation\">\\</span>RegisterProviders</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name class-name-fully-qualified static-context\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap<span class=\"token punctuation\">\\</span>BootProviders</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">app</span><span class=\"token operator\">-></span><span class=\"token function\">hasBeenBootstrapped</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">app</span><span class=\"token operator\">-></span><span class=\"token function\">bootstrapWith</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">bootstrappers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>When a request comes through, it's sent to the router. Just before that, the <code class=\"language-text\">bootstrap()</code> method is invoked, which uses the <code class=\"language-text\">bootstrappers</code> array to prepare the application. If you explore the <code class=\"language-text\">bootstrapWith()</code> method in the <code class=\"language-text\">\\Illuminate\\Foundation\\Application</code> class, it iterates through these bootstrappers, calling their <code class=\"language-text\">bootstrap()</code> method. For simplicity, let's just focus on <code class=\"language-text\">\\Illuminate\\Foundation\\Bootstrap\\RegisterFacades</code>, which we know contains a <code class=\"language-text\">bootstrap()</code> method that will be invoked in <code class=\"language-text\">bootstrapWith()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Application</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>AliasLoader</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>PackageManifest</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Facade</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">RegisterFacades</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Application</span> <span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name static-context\">Facade</span><span class=\"token operator\">::</span><span class=\"token function\">clearResolvedInstances</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name static-context\">Facade</span><span class=\"token operator\">::</span><span class=\"token function\">setFacadeApplication</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Interested here</span>\n\n        <span class=\"token class-name static-context\">AliasLoader</span><span class=\"token operator\">::</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token function\">array_merge</span><span class=\"token punctuation\">(</span>\n            <span class=\"token variable\">$app</span><span class=\"token operator\">-></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'config'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'app.aliases'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token variable\">$app</span><span class=\"token operator\">-></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">PackageManifest</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">aliases</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>And there it is, we're setting the application container on the <code class=\"language-text\">Facade</code> class using the static method <code class=\"language-text\">setFacadeApplication()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// RegisterFacades.php</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">setFacadeApplication</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$app</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$app</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>See, we assign the <code class=\"language-text\">$app</code> property that we're testing within <code class=\"language-text\">resolveFacadeInstance()</code>. This is answers the question, let's continue</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Facade.php</span>\n\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">resolveFacadeInstance</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$resolvedInstance</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$resolvedInstance</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$cached</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$resolvedInstance</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We confirmed that <code class=\"language-text\">$app</code> is set during the application bootstrapping. The next step is to check whether the resolved instance should be cached by verifying <code class=\"language-text\">$cached</code>, which defaults to true. Finally, we retrieve the instance from the application container, in our case, it's like asking <code class=\"language-text\">static::$app['router']</code> to provide any class bound to the string <code class=\"language-text\">router</code>. Now, you might wonder why we access <code class=\"language-text\">$app</code> like an array despite it being an instance of the application container, so an <em>object</em>. Well, you're right! However, the application container implements a PHP interface called <a href=\"https://www.php.net/manual/en/class.arrayaccess.php\"><code class=\"language-text\">ArrayAccess</code></a>, allowing array-like access. We can take a look at it to confirm this fact</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Container</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ArrayAccess</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &lt;- this guy</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Container<span class=\"token punctuation\">\\</span>Container</span> <span class=\"token keyword\">as</span> ContainerContract<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Container</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ArrayAccess</span><span class=\"token punctuation\">,</span> ContainerContract <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>So the <code class=\"language-text\">resolveFacadeInstance()</code> indeed returns an instance bound to the <code class=\"language-text\">router</code> string, specifically, <code class=\"language-text\">\\Illuminate\\Routing\\Router</code>. How did I know? Take a look at the <code class=\"language-text\">Route</code> facade, often, you will find a PHPDoc <code class=\"language-text\">@see</code> hinting at what this facade conceals or, more precisely, to what class our method calls will be proxied.</p>\n<p>Now, back to our <code class=\"language-text\">__callStatic</code> method</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">RuntimeException</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Facade</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__callStatic</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">string</span> <span class=\"token variable\">$method</span><span class=\"token punctuation\">,</span> <span class=\"token keyword type-hint\">array</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">mixed</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$instance</span> <span class=\"token operator\">=</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token function\">getFacadeRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token variable\">$instance</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'A facade root has not been set.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$instance</span><span class=\"token operator\">-></span><span class=\"token variable\">$method</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token variable\">$args</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>We have <code class=\"language-text\">$instance</code>, an object of the <code class=\"language-text\">\\Illuminate\\Routing\\Router</code> class. We test if is it set (which, in our case, is confirmed), and we directly invoke the method on it. So, we end up with</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Facade.php</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token variable\">$instance</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">Closure</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And now, you can confirm the <code class=\"language-text\">get()</code> exists within the <code class=\"language-text\">\\Illuminate\\Routing\\Router</code> class</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Routing</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Routing<span class=\"token punctuation\">\\</span>Route</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Routing<span class=\"token punctuation\">\\</span>BindingRegistrar</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Routing<span class=\"token punctuation\">\\</span>Registrar</span> <span class=\"token keyword\">as</span> RegistrarContract<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Router</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BindingRegistrar</span><span class=\"token punctuation\">,</span> RegistrarContract\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">string</span> <span class=\"token variable\">$uri</span><span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">array</span><span class=\"token operator\">|</span><span class=\"token keyword type-declaration\">string</span><span class=\"token operator\">|</span><span class=\"token keyword\">callable</span><span class=\"token operator\">|</span><span class=\"token keyword type-declaration\">null</span> <span class=\"token variable\">$action</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token class-name return-type\">Route</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">addRoute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'HEAD'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$uri</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$action</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>That wraps it up! Wasn't that difficult in the end? To recap, a facade returns a string that's bound to the container. For instance, <code class=\"language-text\">hello-world</code> might be bound to the <code class=\"language-text\">HelloWorld</code> class. When we statically invoke an undefined method on a facade, <code class=\"language-text\">HelloWorldFacade</code> for example, <code class=\"language-text\">__callStatic()</code> steps in. It resolves the string registered in its <code class=\"language-text\">getFacadeAccessor()</code> method to whatever is bound within the container and proxies our call to that retrieved instance. Thus, we end up with <code class=\"language-text\">(new HelloWorld())->method()</code>. That's the essence of it! Still didn't click for you? let's create our facade then!</p>\n<h2>Let's make our Facade</h2>\n<p>Say we have this class</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">HelloWorld</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">greet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string double-quoted-string\">\"Hello, World!\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<p>The goal is to invoke <code class=\"language-text\">HelloWorld::greet()</code>. To do this, we'll bind our class to the application container. First, navigate to <code class=\"language-text\">AppServiceProvider</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Providers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>ServiceProvider</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">AppServiceProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceProvider</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">app</span><span class=\"token operator\">-></span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'hello-world'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloWorld</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Now, whenever we request <code class=\"language-text\">hello-world</code> from our application container (or the box, as I mentioned earlier), it returns an instance of <code class=\"language-text\">HelloWorld</code>. What's left? Simply create a facade that returns the string <code class=\"language-text\">hello-world</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Facades</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Facade</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">HelloWorldFacade</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Facade</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFacadeAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'hello-world'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<p>With this in place, we're ready to use it. Let's call it within our <code class=\"language-text\">web.php</code></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Facades</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Route</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name static-context\">Route</span><span class=\"token operator\">::</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name static-context\">HelloWorldFacade</span><span class=\"token operator\">::</span><span class=\"token function\">greet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Hello, World!</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>We know that <code class=\"language-text\">greet()</code> does not exist on the <code class=\"language-text\">HelloWorldFacade</code> facade, <code class=\"language-text\">__callStatic()</code> is triggered. It pulls a class represented by a string (<code class=\"language-text\">hello-world</code> in our case) from the application container. And we have already made this binding in the <code class=\"language-text\">AppServiceProvider</code>, we instructed it to provide an instance of <code class=\"language-text\">HelloWorld</code> whenever someone requests a <code class=\"language-text\">hello-world</code>. Consequently, any call, such as <code class=\"language-text\">greet()</code>, will operate on that retrieved instance of <code class=\"language-text\">HelloWorld</code>. And that's it.</p>\n<p>Congratulations! You've created your very own facade!</p>\n<h2>Laravel Real-Time Facades</h2>\n<p>Now that you have a good understanding of facades, there's one more magic trick to unveil. Imagine being able to call <code class=\"language-text\">HelloWorld::greet()</code> without creating a facade, using <a href=\"https://laravel.com/docs/10.x/facades#real-time-facades\">real-time facades</a>.</p>\n<p>Let's have a look</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Facades<span class=\"token punctuation\">\\</span>App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Notice the prefix</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Route</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name static-context\">Route</span><span class=\"token operator\">::</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name static-context\">HelloWorld</span><span class=\"token operator\">::</span><span class=\"token function\">greet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Hello, World!</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>By prefixing the controllers namespace with <code class=\"language-text\">Facades</code>, we achieve the same result as earlier. But, it's certain that the <code class=\"language-text\">HelloWorld</code> controller doesn't have any static method named <code class=\"language-text\">greet()</code>! And where does <code class=\"language-text\">Facades\\App\\Http\\Controllers\\HelloWorld</code> even come from? I understand this might seem like some sorcery, but once you grasp it, it's quite simple.</p>\n<p>Let's take a closer look at <code class=\"language-text\">\\Illuminate\\Foundation\\Bootstrap\\RegisterFacades</code> we checked earlier, the class responsible for setting the <code class=\"language-text\">$app</code></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Bootstrap</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Application</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>AliasLoader</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>PackageManifest</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Facade</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">RegisterFacades</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Application</span> <span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name static-context\">Facade</span><span class=\"token operator\">::</span><span class=\"token function\">clearResolvedInstances</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name static-context\">Facade</span><span class=\"token operator\">::</span><span class=\"token function\">setFacadeApplication</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name static-context\">AliasLoader</span><span class=\"token operator\">::</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token function\">array_merge</span><span class=\"token punctuation\">(</span>\n            <span class=\"token variable\">$app</span><span class=\"token operator\">-></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'config'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'app.aliases'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token variable\">$app</span><span class=\"token operator\">-></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">PackageManifest</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">aliases</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Interested here</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>You can see at the very end, the <code class=\"language-text\">register()</code> method is invoked. Let's take a peek inside</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">AliasLoader</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$registered</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">registered</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">prependToLoaderStack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">registered</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<p>The <code class=\"language-text\">$registered</code> variable is initially set to <code class=\"language-text\">false</code>. Therefore, we enter the <code class=\"language-text\">if</code> statement and call the <code class=\"language-text\">prependToLoaderStack()</code> method. Now, let's explore its implementation</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// AliasLoader.php</span>\n\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">prependToLoaderStack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">spl_autoload_register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$this</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'load'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is where the magic happens! Laravel is calling the <a href=\"https://www.php.net/manual/en/function.spl-autoload-register.php\"><code class=\"language-text\">spl_autoload_register()</code></a> function, a built-in PHP function that triggers when attempting to access an undefined class. It defines the logic to execute in such situations. In this case, Laravel chooses to invoke the <code class=\"language-text\">load()</code> method when encountering an undefined call. Additionally, <code class=\"language-text\">spl_autoload_register()</code> automatically passes the name of the undefined class to whichever method or function it calls.</p>\n<p>Let's explore the <code class=\"language-text\">load()</code> method, it must be the key</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// AliasLoader.php</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">load</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$facadeNamespace</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">str_starts_with</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">,</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$facadeNamespace</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">loadFacade</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">aliases</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">class_alias</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">aliases</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$alias</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We check if <code class=\"language-text\">$facadeNamespace</code> is set, and if whatever class passed, in our case <code class=\"language-text\">Facades\\App\\Http\\Controllers\\HelloWorld</code> starts with whatever set in <code class=\"language-text\">$facadeNamespace</code></p>\n<p>The logic checks if <code class=\"language-text\">$facadeNamespace</code> is set and if the passed class, in our case <code class=\"language-text\">Facades\\App\\Http\\Controllers\\HelloWorld</code> (which is undefined), starts with the value specified in <code class=\"language-text\">$facadeNamespace</code></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// AliasLoader.php</span>\n\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token variable\">$facadeNamespace</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'Facades\\\\'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Since we've prefixed our controller's namespace with <code class=\"language-text\">Facades</code>, satisfying the condition, we proceed to <code class=\"language-text\">loadFacade()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// AliasLoader.php</span>\n\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">loadFacade</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">require</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">ensureFacadeExists</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here, the method requires whatever path is returned from <code class=\"language-text\">ensureFacadeExists()</code>. So, the next step is to delve into its implementation</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// AliasLoader.php</span>\n\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">ensureFacadeExists</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$path</span> <span class=\"token operator\">=</span> <span class=\"token function\">storage_path</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'framework/cache/facade-'</span><span class=\"token operator\">.</span><span class=\"token function\">sha1</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$alias</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$path</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">file_put_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$path</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">formatFacadeStub</span><span class=\"token punctuation\">(</span>\n        <span class=\"token variable\">$alias</span><span class=\"token punctuation\">,</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__DIR__</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/stubs/facade.stub'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$path</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>First, a check is made to ascertain if a file named <code class=\"language-text\">framework/cache/facade-'.sha1($alias).'.php'</code> exists. In our case, this file isn't present, triggering the next step: <code class=\"language-text\">file_put_contents()</code>. This function creates a file and saves it to the specified <code class=\"language-text\">$path</code>. The file's content is generated by <code class=\"language-text\">formatFacadeStub()</code>, which, judging by its name, creates a facade from a stub. If you were to inspect <code class=\"language-text\">facade.stub</code>, you'd find the following</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">DummyNamespace</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Facade</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @see \\DummyTarget\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">DummyClass</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Facade</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Get the registered name of the component.\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFacadeAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'DummyTarget'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Looks familiar? That's essentially what we did manually. Now, <code class=\"language-text\">formatFacadeStub()</code> replaces the dummy content with our undefined class after removing the <code class=\"language-text\">Facades\\\\</code> prefix. This updated facade is then stored. Consequently, when <code class=\"language-text\">loadFacade()</code> requires the file, it does so correctly, and it end up requiring the following file</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Facades<span class=\"token punctuation\">\\</span>App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Facade</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @see \\App\\Http\\Controllers\\HelloWorld\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">HelloWorld</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Facade</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Get the registered name of the component.\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFacadeAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'App\\Http\\Controllers\\HelloWorld'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>And now, the usual flow, we ask the application container to return any instance bound to the string <code class=\"language-text\">App\\Http\\Controllers\\HelloWorld</code>. You might be wondering, we didn't bind this string to anything, we didn't even touch our <code class=\"language-text\">AppServiceProvider</code>. But remember what I mentioned about the application container at the very beginning? <em>Even if the box is empty, it will return the instance</em>, but with one condition, the class must not have a constructor. Otherwise, it wouldn't know how to build it for you. In our case, our <code class=\"language-text\">HelloWorld</code> class doesn't need any arguments to be constructed. So, the container resolves it, returns it and all the calls get proxied to it.</p>\n<p>Recapping real-time facades: We've prefixed our class with <code class=\"language-text\">Facades</code>. During application bootstrapping, Laravel registers <code class=\"language-text\">spl_autoload_register()</code>, which triggers when we call undefined classes. It eventually leads to the <code class=\"language-text\">load()</code> method. Inside <code class=\"language-text\">load()</code>, we check if the current undefined class is prefixed with <code class=\"language-text\">Facades</code>. It matches, so Laravel tries to load it. Since the facade doesn't exist, it creates it from a stub, then requires the file. And voila! You've got a regular facade, but this one was created on the fly. Pretty cool, huh?</p>\n<h2>Conclusion</h2>\n<p>Congratulations on making it this far! I understand it can a bit overwhelming. Feel free to go back and re-read any sections that didn't quite click for you. Following up with your IDE can also help. But hey, no more black magic, must feel good, at least that's how I felt the first time!</p>\n<p>And remember, next time you call a method statically, it might not be the case ðŸª„</p>","frontmatter":{"title":"Laravel Under The Hood - Facades","date":"December 18, 2023","description":"Laravel offers an elegant method-calling feature called Facades. At first glance, they resemble static methods, but well, they are not! What kind of magic is Laravel doing?"}},"previous":{"fields":{"slug":"/laravel-core-csrf/"},"frontmatter":{"title":"Laravel Under The Hood - CSRF"}},"next":null},"pageContext":{"id":"dd83214f-98ff-5a9b-a1f6-07a02ac42647","previousPostId":"37a1019d-eebc-5e04-841c-ae70e4179b1d","nextPostId":null}},"staticQueryHashes":["2841359383","494442451"],"slicesMap":{}}
{"componentChunkName":"component---src-templates-blog-post-js","path":"/laravel-envoy/","result":{"data":{"site":{"siteMetadata":{"title":"Personal Blog"}},"markdownRemark":{"id":"1688fdbe-9fd5-5856-9d6c-a15e2ddcc0f7","excerpt":"Laravel Envoy  Laravel Envoy is a tool for executing common tasks you run on your remote servers. I believe  is underrated, I don't see it being used very often‚Ä¶","html":"<h2>Laravel Envoy</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a52e8a3f3db1cd7ffe0ab1c5d11e4c44/d4c13/envoy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.21518987341772%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42nWPW0vDQBBG+z9Fa2rSS2qaa6M+CUpFQdRS8UGoVqp/Md9uXo4kqwFpfRg+Zpk5c7Zn7m5QOsM+PWAWV1TeIdVJH8VTlMVonqE8QecFymPM9SUqEqrBEQq8nerZ9Sv11xa7ecM+Lx2wGZ6n2NWS+vMD+3hPvd1gX1bY9zU6y/8HVv4x5qLE3C5QEjm7wHM5C1v75l3xqcux38Ga3b3A1qp/8HcwClGZoSJFZe6+/JvRpDu8A+ya4aCDtcCxj8IRmgQ/NXQ5HTnLPXYN8Bu1Ihn5GcVgSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"envoy\"\n        title=\"envoy\"\n        src=\"/static/a52e8a3f3db1cd7ffe0ab1c5d11e4c44/f058b/envoy.png\"\n        srcset=\"/static/a52e8a3f3db1cd7ffe0ab1c5d11e4c44/c26ae/envoy.png 158w,\n/static/a52e8a3f3db1cd7ffe0ab1c5d11e4c44/6bdcf/envoy.png 315w,\n/static/a52e8a3f3db1cd7ffe0ab1c5d11e4c44/f058b/envoy.png 630w,\n/static/a52e8a3f3db1cd7ffe0ab1c5d11e4c44/d4c13/envoy.png 825w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Laravel Envoy is a tool for executing common tasks you run on your remote servers.</p>\n</blockquote>\n<p>I believe <code class=\"language-text\">Envoy</code> is underrated, I don't see it being used very often, even though I have always found it super useful. In this article, we will explore how <code class=\"language-text\">Envoy</code> can help increase your productivityüöÄ.</p>\n<p>First, let's discuss two key concepts in <code class=\"language-text\">Envoy</code>:</p>\n<ol>\n<li><strong>Tasks</strong>: which represents a specific action like updating the server or cloning a repository.</li>\n<li><strong>Stories</strong>: which is a collection of Tasks.</li>\n</ol>\n<p>That's all you need to know for now, you can always read about all the features in the <a href=\"https://laravel.com/docs/10.x/envoy\">docs</a>.</p>\n<h2>What are we automating?</h2>\n<p>In this article, we will automate 2 things most developers do when deploying a <code class=\"language-text\">Laravel</code> application:</p>\n<ol>\n<li>Configuring Nginx.</li>\n<li>Generating SSH keys and adding them to GitHub to be able to access private repositories.</li>\n</ol>\n<p>Yes I know, most of the times <code class=\"language-text\">Envoy</code> is used for CI/CD workflows, but it can do <strong>EVERYTHING</strong>, literally.</p>\n<h2>Envoy Setup</h2>\n<p>First let's create a directory</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> tuto <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$_</span> </code></pre></div>\n<blockquote>\n<p><code class=\"language-text\">$ take tuto</code> if you are using <code class=\"language-text\">zsh</code>.</p>\n</blockquote>\n<p>Install <code class=\"language-text\">Envoy</code> by running the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">composer</span> require laravel/envoy <span class=\"token parameter variable\">--dev</span></code></pre></div>\n<blockquote>\n<p>Make sure you have composer installed.</p>\n</blockquote>\n<p>Now create a file called <code class=\"language-text\">Envoy.blade.php</code>. Yes we will be using the <code class=\"language-text\">Blade</code> syntax, super cool right?</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> Envoy.blade.php</code></pre></div>\n<p>That will do it, let's start automating üòÅ</p>\n<h2>Configure Nginx</h2>\n<p>We have a brand new server, and we want to setup Nginx. If we break down the process it would be like:</p>\n<ol>\n<li>Update the server</li>\n<li>Install Nginx</li>\n<li>Configure Nginx</li>\n</ol>\n<p>That's exactly what we will be doing with <code class=\"language-text\">Envoy</code>, think of each step as a <code class=\"language-text\">Task</code>, and the entire process as a <code class=\"language-text\">Story</code>.</p>\n<p>So let's translate what we have just said into a story:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">servers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'oussama@192.168.1.100'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'local'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'127.0.0.1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\r\n@<span class=\"token function\">story</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'setup-nginx'</span><span class=\"token punctuation\">)</span>\r\n    update<span class=\"token operator\">-</span>server\r\n    install<span class=\"token operator\">-</span>nginx\r\n    copy<span class=\"token operator\">-</span>nginx<span class=\"token operator\">-</span>stub\r\n    configure<span class=\"token operator\">-</span>nginx\r\n@endstory</code></pre></div>\n<blockquote>\n<p>The <code class=\"language-text\">@servers</code> directive is used to specify the servers on which we will be running our tasks later on.</p>\n</blockquote>\n<p>Now we can proceed to define each task üòÅ</p>\n<p>Our first task <code class=\"language-text\">update-server</code> will ensure that the server's packages and dependencies are up to date:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'update-server'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Updating server...\"</span>\r\n\r\n    apt update <span class=\"token operator\">&amp;&amp;</span> apt upgrade <span class=\"token operator\">-</span>y\r\n@endtask</code></pre></div>\n<p>The second task <code class=\"language-text\">install-nginx</code> will install Nginx on our server:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'install-nginx'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Installing nginx...\"</span>\r\n\r\n    apt install nginx <span class=\"token operator\">-</span>y\r\n\r\n    rm <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token keyword\">default</span> <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token keyword\">default</span>\r\n\r\n    touch <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n\r\n    ln <span class=\"token operator\">-</span>s <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask</code></pre></div>\n<p>Notice that we have removed the default Nginx link and created a new one for our application, with the name coming from the <code class=\"language-text\">$application_name</code> variable.</p>\n<p>To be able to use that variable, you need to declare it, so we need to include the <code class=\"language-text\">@setup</code> directive:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token class-name type-declaration\">setup</span>\r\n    <span class=\"token variable\">$application_name</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'your-application-name'</span><span class=\"token punctuation\">;</span>\r\n@endsetup</code></pre></div>\n<p>Now we can move to the third task <code class=\"language-text\">copy-nginx-stub</code>. We will use the Nginx configuration file provided by the <a href=\"https://laravel.com/docs/10.x/deployment#nginx\">docs</a>, with few tweaks.</p>\n<p>So, in your directory, run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> stubs<span class=\"token punctuation\">;</span> <span class=\"token function\">nano</span> stubs/nginx.conf</code></pre></div>\n<p>Then, paste the following content into the editor, save it, and exit:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">server <span class=\"token punctuation\">{</span>\r\n    listen <span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\r\n    listen <span class=\"token punctuation\">[</span><span class=\"token operator\">::</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span><span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\r\n    server_name public_ip<span class=\"token punctuation\">;</span>\r\n    root <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>www<span class=\"token operator\">/</span>app_name<span class=\"token operator\">/</span><span class=\"token keyword\">public</span><span class=\"token punctuation\">;</span>\r\n \r\n    add_header <span class=\"token constant\">X</span><span class=\"token operator\">-</span>Frame<span class=\"token operator\">-</span>Options <span class=\"token string double-quoted-string\">\"SAMEORIGIN\"</span><span class=\"token punctuation\">;</span>\r\n    add_header <span class=\"token constant\">X</span><span class=\"token operator\">-</span>Content<span class=\"token operator\">-</span>Type<span class=\"token operator\">-</span>Options <span class=\"token string double-quoted-string\">\"nosniff\"</span><span class=\"token punctuation\">;</span>\r\n \r\n    index index<span class=\"token operator\">.</span>php<span class=\"token punctuation\">;</span>\r\n \r\n    charset utf<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\r\n \r\n    location <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name type-declaration\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span><span class=\"token operator\">/</span> <span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span><span class=\"token variable\">$query_string</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n \r\n    location <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>favicon<span class=\"token operator\">.</span>ico <span class=\"token punctuation\">{</span> access_log off<span class=\"token punctuation\">;</span> log_not_found off<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\r\n    location <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>robots<span class=\"token operator\">.</span>txt  <span class=\"token punctuation\">{</span> access_log off<span class=\"token punctuation\">;</span> log_not_found off<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\r\n \r\n    error_page <span class=\"token number\">404</span> <span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token punctuation\">;</span>\r\n \r\n    location <span class=\"token operator\">~</span> \\<span class=\"token operator\">.</span><span class=\"token class-name type-declaration\">php</span>$ <span class=\"token punctuation\">{</span>\r\n        fastcgi_pass unix<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>run<span class=\"token operator\">/</span>php<span class=\"token operator\">/</span>php8<span class=\"token operator\">.</span><span class=\"token number\">0</span><span class=\"token operator\">-</span>fpm<span class=\"token operator\">.</span>sock<span class=\"token punctuation\">;</span>\r\n        fastcgi_param <span class=\"token class-name type-declaration\">SCRIPT_FILENAME</span> <span class=\"token variable\">$realpath_root</span><span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">include</span> fastcgi_params<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n \r\n    location <span class=\"token operator\">~</span> <span class=\"token operator\">/</span>\\<span class=\"token operator\">.</span><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">!</span>well<span class=\"token operator\">-</span>known<span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token operator\">*</span> <span class=\"token punctuation\">{</span>\r\n        deny all<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">public_ip</code> and <code class=\"language-text\">app_name</code> are placeholders for now and will be  automatically updated with our variables.</p>\n<p>Let's move on to writing the task itself:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'copy-nginx-stub'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'local'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    scp <span class=\"token operator\">-</span><span class=\"token constant\">P</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$production_port</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>r <span class=\"token operator\">.</span><span class=\"token operator\">/</span>stubs<span class=\"token operator\">/</span>nginx<span class=\"token operator\">.</span>conf\r\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$production_host</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask</code></pre></div>\n<blockquote>\n<p>This task will be executed on our local machine instead of the remote server. We specify this using <code class=\"language-text\">'on' => 'local'</code>.</p>\n</blockquote>\n<p>And don't forget to update the <code class=\"language-text\">@setup</code> directive with the necessary variables:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token class-name type-declaration\">setup</span>\r\n    <span class=\"token variable\">$application_name</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'your-application-name'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$production_port</span> <span class=\"token operator\">=</span> <span class=\"token number\">22</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$production_host</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'oussama@192.168.1.103'</span><span class=\"token punctuation\">;</span>\r\n@endsetup</code></pre></div>\n<p>The fourth and final task <code class=\"language-text\">configure-nginx</code> will update the placeholders, so we can serve the application correctly:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'configure-nginx'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Configuring nginx...\"</span>\r\n\r\n    cd <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span>\r\n\r\n    sed <span class=\"token operator\">-</span>i <span class=\"token string single-quoted-string\">'s/app_name/{{ $application_name }}/g'</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n    sed <span class=\"token operator\">-</span>i <span class=\"token string single-quoted-string\">'s/public_ip/{{ $production_ip }}/g'</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask</code></pre></div>\n<blockquote>\n<p>Note the <code class=\"language-text\">cd</code> command. This is because each task is executed separately, so it always starts from the home directory of the remote server.</p>\n</blockquote>\n<blockquote>\n<p>We have already created the symlink when installing Nginx, we don't have to worry about it now.</p>\n</blockquote>\n<p>And we are done for this section! Your script should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">servers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'oussama@192.168.1.100'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'local'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'127.0.0.1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\r\n@<span class=\"token class-name type-declaration\">setup</span>\r\n    <span class=\"token variable\">$application_name</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'your-application-name'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$production_port</span> <span class=\"token operator\">=</span> <span class=\"token number\">22</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$production_host</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'oussama@192.168.1.103'</span><span class=\"token punctuation\">;</span>\r\n@endsetup\r\n\r\n@<span class=\"token function\">story</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'setup-nginx'</span><span class=\"token punctuation\">)</span>\r\n    update<span class=\"token operator\">-</span>server\r\n    install<span class=\"token operator\">-</span>nginx\r\n    copy<span class=\"token operator\">-</span>nginx<span class=\"token operator\">-</span>stub\r\n    configure<span class=\"token operator\">-</span>nginx\r\n@endstory\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'update-server'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Updating server...\"</span>\r\n\r\n    apt update <span class=\"token operator\">&amp;&amp;</span> apt upgrade <span class=\"token operator\">-</span>y\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'install-nginx'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Installing nginx...\"</span>\r\n\r\n    apt install nginx <span class=\"token operator\">-</span>y\r\n\r\n    rm <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token keyword\">default</span> <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token keyword\">default</span>\r\n\r\n    touch <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n\r\n    ln <span class=\"token operator\">-</span>s <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'copy-nginx-stub'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'local'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    scp <span class=\"token operator\">-</span><span class=\"token constant\">P</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$production_port</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>r <span class=\"token operator\">.</span><span class=\"token operator\">/</span>stubs<span class=\"token operator\">/</span>nginx<span class=\"token operator\">.</span>conf\r\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$production_host</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'configure-nginx'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Configuring nginx...\"</span>\r\n\r\n    cd <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span>\r\n\r\n    sed <span class=\"token operator\">-</span>i <span class=\"token string single-quoted-string\">'s/app_name/{{ $application_name }}/g'</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n    sed <span class=\"token operator\">-</span>i <span class=\"token string single-quoted-string\">'s/public_ip/{{ $production_ip }}/g'</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask</code></pre></div>\n<h2>SSH Key Configuration</h2>\n<p>Now that we configured Nginx, and it is ready to serve our application, we need to generate ssh keys, and add the public key to Github so we can pull the private repositories.</p>\n<p>For this we will use <a href=\"https://docs.github.com/en/rest?apiVersion=2022-11-28\">GitHub REST API</a>, so before we start, you need to <a href=\"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens\">create a token</a>.</p>\n<blockquote>\n<p>When creating your token, ensure that you only select the \"admin:public_key\" scope.</p>\n</blockquote>\n<p>Now that you created your token, let's begin by defining some variables:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token class-name type-declaration\">setup</span>\r\n    <span class=\"token variable\">$ssh_key</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'~/.ssh/id_rsa_github'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$github_api_key</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'your-github-token'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$email</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'oussama@example.com'</span><span class=\"token punctuation\">;</span>\r\n@endsetup</code></pre></div>\n<p>At this point, you might be wondering about the steps involved in this process. Well we can break it down into two steps:</p>\n<ol>\n<li>Generate SSH keys</li>\n<li>Copy the public key to Github</li>\n</ol>\n<p>Once again this process will be our story:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">story</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'setup-ssh-keys'</span><span class=\"token punctuation\">)</span>\r\n    generate<span class=\"token operator\">-</span>ssh<span class=\"token operator\">-</span>keys\r\n    add<span class=\"token operator\">-</span>ssh<span class=\"token operator\">-</span>keys<span class=\"token operator\">-</span>to<span class=\"token operator\">-</span>github\r\n@endstory</code></pre></div>\n<p>The first task <code class=\"language-text\">generate-ssh-keys</code>, can be done by running a single command:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'generate-ssh-keys'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Generating ssh keys...\"</span>\r\n\r\n    ssh<span class=\"token operator\">-</span>keygen <span class=\"token operator\">-</span>t ed25519 <span class=\"token operator\">-</span>f <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$ssh_key</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span><span class=\"token constant\">N</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">-</span>q <span class=\"token operator\">-</span><span class=\"token constant\">C</span> <span class=\"token string double-quoted-string\">\"{{ <span class=\"token interpolation\"><span class=\"token variable\">$email</span></span> }}\"</span>\r\n@endtask</code></pre></div>\n<p>Once we have generated our SSH keys, we can add the public key to Github using the Github API. This can be done with a single request:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'add-ssh-keys-to-github'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Adding ssh keys to github...\"</span>\r\n\r\n    key<span class=\"token operator\">=</span>$<span class=\"token punctuation\">(</span>cat <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$ssh_key</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>pub<span class=\"token punctuation\">)</span>\r\n\r\n    curl <span class=\"token operator\">--</span>request <span class=\"token constant\">POST</span> \\\r\n    <span class=\"token operator\">--</span>url https<span class=\"token punctuation\">:</span><span class=\"token comment\">//api.github.com/user/keys \\</span>\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'Accept: application/vnd.github+json'</span> \\\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'Authorization: Bearer {{ $github_api_key }}'</span> \\\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'Content-Type: application/json'</span> \\\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'X-GitHub-Api-Version: 2022-11-28'</span> \\\r\n    <span class=\"token operator\">--</span>data <span class=\"token string single-quoted-string\">'{\r\n    \"title\": \"[Envoy] Public key\",\r\n    \"key\": \"'</span><span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$key</span></span>\"</span><span class=\"token string single-quoted-string\">'\"\r\n    }'</span>\r\n@endtask</code></pre></div>\n<p>And that's it! If you visit your Github developer settings, you should see your newly created key.</p>\n<p>By combining the two sections, your final script should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token function\">servers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'oussama@192.168.1.100'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'local'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'127.0.0.1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\r\n@<span class=\"token class-name type-declaration\">setup</span>\r\n    <span class=\"token variable\">$application_name</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'your-application-name'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$production_port</span> <span class=\"token operator\">=</span> <span class=\"token number\">22</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$production_host</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'oussama@192.168.1.103'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$ssh_key</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'~/.ssh/id_rsa_github'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$github_api_key</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'your-github-token'</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token variable\">$email</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'oussama@example.com'</span><span class=\"token punctuation\">;</span>\r\n@endsetup\r\n\r\n@<span class=\"token function\">story</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'setup-nginx'</span><span class=\"token punctuation\">)</span>\r\n    update<span class=\"token operator\">-</span>server\r\n    install<span class=\"token operator\">-</span>nginx\r\n    copy<span class=\"token operator\">-</span>nginx<span class=\"token operator\">-</span>stub\r\n    configure<span class=\"token operator\">-</span>nginx\r\n@endstory\r\n\r\n@<span class=\"token function\">story</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'setup-ssh-keys'</span><span class=\"token punctuation\">)</span>\r\n    generate<span class=\"token operator\">-</span>ssh<span class=\"token operator\">-</span>keys\r\n    add<span class=\"token operator\">-</span>ssh<span class=\"token operator\">-</span>keys<span class=\"token operator\">-</span>to<span class=\"token operator\">-</span>github\r\n@endstory\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'update-server'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Updating server...\"</span>\r\n\r\n    apt update <span class=\"token operator\">&amp;&amp;</span> apt upgrade <span class=\"token operator\">-</span>y\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'install-nginx'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Installing Nginx...\"</span>\r\n\r\n    apt install nginx <span class=\"token operator\">-</span>y\r\n\r\n    rm <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token keyword\">default</span> <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token keyword\">default</span>\r\n\r\n    touch <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n\r\n    ln <span class=\"token operator\">-</span>s <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'copy-nginx-stub'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'local'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    scp <span class=\"token operator\">-</span><span class=\"token constant\">P</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$production_port</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>r <span class=\"token operator\">.</span><span class=\"token operator\">/</span>stubs<span class=\"token operator\">/</span>nginx<span class=\"token operator\">.</span>conf\r\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$production_host</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'configure-nginx'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Configuring nginx...\"</span>\r\n\r\n    cd <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>available<span class=\"token operator\">/</span>\r\n\r\n    sed <span class=\"token operator\">-</span>i <span class=\"token string single-quoted-string\">'s/app_name/{{ $application_name }}/g'</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n    sed <span class=\"token operator\">-</span>i <span class=\"token string single-quoted-string\">'s/public_ip/{{ $production_ip }}/g'</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$application_name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>conf\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'generate-ssh-keys'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Generating ssh keys...\"</span>\r\n\r\n    ssh<span class=\"token operator\">-</span>keygen <span class=\"token operator\">-</span>t ed25519 <span class=\"token operator\">-</span>f <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$ssh_key</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span><span class=\"token constant\">N</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">-</span>q <span class=\"token operator\">-</span><span class=\"token constant\">C</span> <span class=\"token string double-quoted-string\">\"{{ <span class=\"token interpolation\"><span class=\"token variable\">$email</span></span> }}\"</span>\r\n@endtask\r\n\r\n@<span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'add-ssh-keys-to-github'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'on'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'web'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Adding ssh keys to github...\"</span>\r\n\r\n    key<span class=\"token operator\">=</span>$<span class=\"token punctuation\">(</span>cat <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token variable\">$ssh_key</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">.</span>pub<span class=\"token punctuation\">)</span>\r\n\r\n    curl <span class=\"token operator\">--</span>request <span class=\"token constant\">POST</span> \\\r\n    <span class=\"token operator\">--</span>url https<span class=\"token punctuation\">:</span><span class=\"token comment\">//api.github.com/user/keys \\</span>\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'Accept: application/vnd.github+json'</span> \\\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'Authorization: Bearer {{ $github_api_key }}'</span> \\\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'Content-Type: application/json'</span> \\\r\n    <span class=\"token operator\">--</span>header <span class=\"token string single-quoted-string\">'X-GitHub-Api-Version: 2022-11-28'</span> \\\r\n    <span class=\"token operator\">--</span>data <span class=\"token string single-quoted-string\">'{\r\n    \"title\": \"creating from script\",\r\n    \"key\": \"'</span><span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$key</span></span>\"</span><span class=\"token string single-quoted-string\">'\"\r\n    }'</span>\r\n@endtask</code></pre></div>\n<h2>Conclusion</h2>\n<p>We learned how to use <code class=\"language-text\">Envoy</code> to automate common tasks. It's a powerful tool with even more capabilities than we've explored here. Don't limit yourself to just deploying your applications, <code class=\"language-text\">Envoy</code> can automate <strong>ANY</strong> terminal command, literally anything that comes to mind.</p>\n<p>The next time you find yourself repeating the same commands, consider using it, I promise you it does way more than CI/CD üòõüòõ</p>","frontmatter":{"title":"Laravel Envoy - Automate the boring stuff","date":"June 18, 2023","description":"If you feel like you are doing the same things over and over again, it's time to automate, and this article is all about how to do it!"}},"previous":{"fields":{"slug":"/vscode-and-laravel-pint/"},"frontmatter":{"title":"VS Code and Laravel Pint - 2 Methods"}},"next":null},"pageContext":{"id":"1688fdbe-9fd5-5856-9d6c-a15e2ddcc0f7","previousPostId":"63393a94-e254-5082-a33d-3f4008d4a0f9","nextPostId":null}},"staticQueryHashes":["2841359383","2911190619"],"slicesMap":{}}
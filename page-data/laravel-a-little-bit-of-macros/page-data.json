{"componentChunkName":"component---src-templates-blog-post-js","path":"/laravel-a-little-bit-of-macros/","result":{"data":{"site":{"siteMetadata":{"title":"Personal Blog"}},"markdownRemark":{"id":"f56ee5c1-86a6-5447-93c4-63499e31560a","excerpt":"Hello üëã  How often have you wished for a method that doesn't exist on collections or string helpers? You start chaining methods, only to hit a wall when one of‚Ä¶","html":"<h2 id=\"hello-\" style=\"position:relative;\"><a href=\"#hello-\" aria-label=\"hello  permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>Hello üëã</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebb446c498cc090b7331bf4124969a74/0f882/cover.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMUlEQVR42iXCW0vCUAAA4P2GCEyEAnVueea2s3M87uKFIIqSiqK8O7aukj4ElYjOzayNQirpJYIiKirNP9mDHx+1s5x5tppPzbOXzuWb3frotb/61o9r/7r2yHPGnvPnORPPnnjd8Y016re/ndZnt/luXbx2zqkVgmw93y7v9YyCe1C6Pa4MavpD3Zh+rBvDhjlsmPenxqCm351UvcOyu1+8NgtXRp4KzYdFGkxLDJAiICVIG+lUNqmtKvKaqq4n1a1MKg2RxHJ4MYZYTmSAyAAhAqhQILAUBZuilOWFbSjtIpzHuETipiLnsKSEgzkEjzTZSCA9AasEVuKwiAWdiFUiUn6fj6Y5ABIcIHxMhjEF8SoStLiYhBxhg2HEEcKriqDhKA7MzizM+SEDUYSHNPcP5tddF8xI12YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"cover\"\n        src=\"/static/ebb446c498cc090b7331bf4124969a74/f058b/cover.png\"\n        srcset=\"/static/ebb446c498cc090b7331bf4124969a74/c26ae/cover.png 158w,\n/static/ebb446c498cc090b7331bf4124969a74/6bdcf/cover.png 315w,\n/static/ebb446c498cc090b7331bf4124969a74/f058b/cover.png 630w,\n/static/ebb446c498cc090b7331bf4124969a74/40601/cover.png 945w,\n/static/ebb446c498cc090b7331bf4124969a74/78612/cover.png 1260w,\n/static/ebb446c498cc090b7331bf4124969a74/0f882/cover.png 1584w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>How often have you wished for a method that doesn't exist on collections or string helpers? You start chaining methods, only to hit a wall when one of them turns out to be missing. Honestly, it's understandable; frameworks, you know, are one-size-fits-all thing. I found myself in this situation multiple times. Every time, before diving into how to extend the framework, I check to see if what I want to extend is <strong>macroable</strong> or not. But what does that mean? That's exactly what we'll be exploring!</p>\n<h2 id=\"wtf-are-macros-\" style=\"position:relative;\"><a href=\"#wtf-are-macros-\" aria-label=\"wtf are macros  permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>WTF are Macros? üçè</h2>\n<p>Let's say we have this JWT:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$jwt</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And we need to extract the headers:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">str</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$jwt</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">fromBase64</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">fromJson</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// does not exist üòû</span>\n\n<span class=\"token comment\">//  BadMethodCallException  Method Illuminate\\Support\\Stringable::fromJson does not exist.</span></code></pre></div>\n<p>The <code class=\"language-text\">fromJson()</code> doesn't exist üòî Sure, one could simply do:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token function\">str</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$jwt</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fromBase64</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>But where's the fun in that? Plus, it is my article ü§∑</p>\n<p>So, we need a way to extend the <code class=\"language-text\">Stringable</code> class. There are a few ways to do this, but Laravel thought ahead, it knew that developers might want to add custom methods, so it made the class <strong>macroable</strong>, or as I like to call it, extendable.</p>\n<blockquote>\n<p>If you inspect the <code class=\"language-text\">Illuminate\\Support\\Stringable</code> class, you'll see it uses a <code class=\"language-text\">Macroable</code> trait.</p>\n</blockquote>\n<p>Let's go ahead and extend the class. In the <code class=\"language-text\">AppServiceProvider</code>, add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Providers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Stringable</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>ServiceProvider</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">AppServiceProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceProvider</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name static-context\">Stringable</span><span class=\"token operator\">::</span><span class=\"token function\">macro</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'fromJson'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">bool</span> <span class=\"token variable\">$associative</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">value</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$associative</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Now let's rerun the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">str</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$jwt</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">fromBase64</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">fromJson</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// [\"alg\" => \"HS256\", \"typ\" => \"JWT\"]</span></code></pre></div>\n<p>It works perfectly üéâ But now, you might be wondering, how did this work? And what exactly is <code class=\"language-text\">$this->value</code>? What in the harry potter is going on?</p>\n<h2 id=\"unveiling-the-magic-\" style=\"position:relative;\"><a href=\"#unveiling-the-magic-\" aria-label=\"unveiling the magic  permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>Unveiling the magic ü™Ñ</h2>\n<p>We know that the <code class=\"language-text\">Stringable</code> class uses the <code class=\"language-text\">Macroable</code> trait, which provides the <code class=\"language-text\">macro()</code> method. Let's take a closer look at what it does:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// src/Illuminate/Macroable/Traits/Macroable.php</span>\n\n<span class=\"token comment\">/**\n * Register a custom macro.\n *\n * @param  string  $name\n * @param  object|callable  $macro\n *\n * @param-closure-this static  $macro\n *\n * @return void\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">macro</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$macro</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$macros</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$macro</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It's pretty straightforward, it just saves the callback to a static <code class=\"language-text\">macros</code> array. Now, if we inspect the trait further, we will find the <code class=\"language-text\">__call</code> method, which is triggered every time a non-existent method is called. In our case, that's <code class=\"language-text\">fromJson()</code>. Let's dive in:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Dynamically handle calls to the class.\n *\n * @param  string  $method\n * @param  array  $parameters\n * @return mixed\n *\n * @throws \\BadMethodCallException\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__call</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$method</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$parameters</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token function\">hasMacro</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$method</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BadMethodCallException</span><span class=\"token punctuation\">(</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string single-quoted-string\">'Method %s::%s does not exist.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$method</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token variable\">$macro</span> <span class=\"token operator\">=</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token variable\">$macros</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$method</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$macro</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Closure</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$macro</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$macro</span><span class=\"token operator\">-></span><span class=\"token function\">bindTo</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$macro</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token variable\">$parameters</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>First, it checks if a macro is registered, which is the case with <code class=\"language-text\">fromJson()</code>, it then fetches the callback (or object) from the macros array. Now for the magic trick, if the macro is a closure (as in our case), it calls <code class=\"language-text\">bindTo()</code>, which essentially tells the closure that <code class=\"language-text\">$this</code> should refer to whatever is passed as the first argument. In this case, it is the <code class=\"language-text\">Stringable</code> instance, which happens to have the <code class=\"language-text\">$value</code> attribute.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// $this here is the stringable</span>\n<span class=\"token comment\">// $this inside the closure is now referencing the stringable class</span>\n<span class=\"token variable\">$macro</span><span class=\"token operator\">-></span><span class=\"token function\">bindTo</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword static-context\">static</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And this is why we can do <code class=\"language-text\">$this->value</code>.</p>\n<h2 id=\"we-can-do-better-mixins-\" style=\"position:relative;\"><a href=\"#we-can-do-better-mixins-\" aria-label=\"we can do better mixins  permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>We can do better: Mixins üß©</h2>\n<p>There is one more thing I want to show you! When we extend the same class a couple of times, the service provider might get messy very quick. We can extract all our custom macros to a class called a Mixin.</p>\n<p>Let's create a <code class=\"language-text\">StringableMixin</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Macros</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Closure</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">StringableMixin</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">fromJson</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token class-name return-type\">Closure</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">bool</span> <span class=\"token variable\">$associative</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">value</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$associative</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Add more macros here as needed</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Now, in <code class=\"language-text\">AppServiceProvider</code>, we can register this mixin:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Macros<span class=\"token punctuation\">\\</span>StringableMixin</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Stringable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">AppServiceProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceProvider</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name static-context\">Stringable</span><span class=\"token operator\">::</span><span class=\"token function\">mixin</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringableMixin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And that's it! Now we can do:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">str</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$jwt</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">fromBase64</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">-></span><span class=\"token function\">fromJson</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>Which is basically the same, just a bit cleaner.</p>\n</blockquote>\n<p>If you are curious about how this works, the <code class=\"language-text\">mixin()</code> method on the <code class=\"language-text\">Macroable</code> trait uses the <a href=\"https://www.php.net/manual/en/book.reflection.php\" target=\"_blank\">reflection API</a>. It retrieves all the public methods from the Mixin class, expects each to return a closure, and then registers the closure as a macro just like we have seen earlier.</p>\n<h2 id=\"the-poor-ide-\" style=\"position:relative;\"><a href=\"#the-poor-ide-\" aria-label=\"the poor ide  permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>The Poor IDE ü•≤</h2>\n<p>Well, as you have seen, there is a lot of magic going on, and the IDE wouldn't know about the defined macros. If you're working within a team, other developers won't know about these macros either, which is not good. Luckily, there are tools to help you with that. A free and open source option is the <a href=\"https://github.com/barryvdh/laravel-ide-helper\" target=\"_blank\">Laravel IDE helper</a> package.</p>\n<p>You can install the package and generate the <code class=\"language-text\">_ide_helper.php</code> file, and you should be good to go.</p>\n<h2 id=\"and-so-it-ends\" style=\"position:relative;\"><a href=\"#and-so-it-ends\" aria-label=\"and so it ends permalink\" class=\"anchor before\"><svg fill=\"#A855F7\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n              viewBox=\"0 0 490 490\" xml:space=\"preserve\">\n           <path d=\"M64.333,490h58.401l33.878-137.69h122.259L245.39,490h58.401l33.878-137.69h119.92v-48.162h-108.24l29.2-117.324h79.04\n             v-48.162H390.23L424.108,0H365.31l-33.878,138.661H208.79L242.668,0h-58.415l-33.864,138.661H32.411v48.162h106.298l-28.818,117.324\n             h-77.48v48.162h65.8L64.333,490z M197.11,186.824h122.642l-29.2,117.324H168.292L197.11,186.824z\"/>\n           </svg></a>And so it ends..</h2>\n<p>Our example is fairly simple, but you can push macros much further than this, as most of the common classes Laravel ships with are macroable. For instance, you can add a new <code class=\"language-text\">apiResponse()</code> macro, or anything that you feel is very common in your app's logic and is being repeated more than it should be. But don't overdo it. Macros add a new layer of complexity, and when working in a team, they could be confusing.</p>\n<p>Soo, whenever you feel something is missing from your application, but not from the framework itself, use macros ü™Ñ</p>","frontmatter":{"title":"Laravel Under The Hood - A Little Bit of Macros","date":"November 03, 2024","description":"One way to extend Laravel with custom methods is through macros and mixins. Let me show you how!"}},"previous":{"fields":{"slug":"/laravel-extend-the-framework/"},"frontmatter":{"title":"Laravel Under The Hood - Extending the framework"}},"next":{"fields":{"slug":"/laravel-custom-query-builders/"},"frontmatter":{"title":"Laravel Custom Query Builders Over Scopes"}}},"pageContext":{"id":"f56ee5c1-86a6-5447-93c4-63499e31560a","previousPostId":"a6bfeea2-1f07-5c8b-8369-1a3cef295f72","nextPostId":"fba302c3-15d8-57e4-a84f-74b918515ec0"}},"staticQueryHashes":["2841359383","494442451"],"slicesMap":{}}